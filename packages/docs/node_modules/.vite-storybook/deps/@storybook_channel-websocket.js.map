{
  "version": 3,
  "sources": ["../../../../../node_modules/@storybook/channel-websocket/dist/esm/index.js"],
  "sourcesContent": ["import \"core-js/modules/es.object.to-string.js\";\r\nimport \"core-js/modules/web.dom-collections.for-each.js\";\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\r\n\r\nimport global from 'global';\r\nimport { Channel } from '@storybook/channels';\r\nimport { logger } from '@storybook/client-logger';\r\nimport { isJSON, parse, stringify } from 'telejson';\r\nvar WebSocket = global.WebSocket;\r\nexport var WebsocketTransport = /*#__PURE__*/function () {\r\n  function WebsocketTransport(_ref) {\r\n    var url = _ref.url,\r\n        onError = _ref.onError;\r\n\r\n    _classCallCheck(this, WebsocketTransport);\r\n\r\n    this.socket = void 0;\r\n    this.handler = void 0;\r\n    this.buffer = [];\r\n    this.isReady = false;\r\n    this.connect(url, onError);\r\n  }\r\n\r\n  _createClass(WebsocketTransport, [{\r\n    key: \"setHandler\",\r\n    value: function setHandler(handler) {\r\n      this.handler = handler;\r\n    }\r\n  }, {\r\n    key: \"send\",\r\n    value: function send(event) {\r\n      if (!this.isReady) {\r\n        this.sendLater(event);\r\n      } else {\r\n        this.sendNow(event);\r\n      }\r\n    }\r\n  }, {\r\n    key: \"sendLater\",\r\n    value: function sendLater(event) {\r\n      this.buffer.push(event);\r\n    }\r\n  }, {\r\n    key: \"sendNow\",\r\n    value: function sendNow(event) {\r\n      var data = stringify(event, {\r\n        maxDepth: 15,\r\n        allowFunction: true\r\n      });\r\n      this.socket.send(data);\r\n    }\r\n  }, {\r\n    key: \"flush\",\r\n    value: function flush() {\r\n      var _this = this;\r\n\r\n      var buffer = this.buffer;\r\n      this.buffer = [];\r\n      buffer.forEach(function (event) {\r\n        return _this.send(event);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"connect\",\r\n    value: function connect(url, onError) {\r\n      var _this2 = this;\r\n\r\n      this.socket = new WebSocket(url);\r\n\r\n      this.socket.onopen = function () {\r\n        _this2.isReady = true;\r\n\r\n        _this2.flush();\r\n      };\r\n\r\n      this.socket.onmessage = function (_ref2) {\r\n        var data = _ref2.data;\r\n        var event = typeof data === 'string' && isJSON(data) ? parse(data) : data;\r\n\r\n        _this2.handler(event);\r\n      };\r\n\r\n      this.socket.onerror = function (e) {\r\n        if (onError) {\r\n          onError(e);\r\n        }\r\n      };\r\n    }\r\n  }]);\r\n\r\n  return WebsocketTransport;\r\n}();\r\nexport default function createChannel(_ref3) {\r\n  var url = _ref3.url,\r\n      _ref3$async = _ref3.async,\r\n      async = _ref3$async === void 0 ? false : _ref3$async,\r\n      _ref3$onError = _ref3.onError,\r\n      onError = _ref3$onError === void 0 ? function (err) {\r\n    return logger.warn(err);\r\n  } : _ref3$onError;\r\n  var transport = new WebsocketTransport({\r\n    url: url,\r\n    onError: onError\r\n  });\r\n  return new Channel({\r\n    transport: transport,\r\n    async: async\r\n  });\r\n}"],
  "mappings": "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",
  "names": ["global", "WebsocketTransport"]
}
